;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;                                                                        ;
;                              OCamlFormat                               ;
;                                                                        ;
;            Copyright (c) Facebook, Inc. and its affiliates.            ;
;                                                                        ;
;      This source code is licensed under the MIT license found in       ;
;      the LICENSE file in the root directory of this source tree.       ;
;                                                                        ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(rule
 (action
  (write-file
   ocamlformat_format.ml
   ; enable release renaming
   "include Ocamlformat_format_devversion"
   ; disable release renaming
   )))

(rule
 (action
  (write-file
   ocamlformat_lib.ml
   ; enable release renaming
   "include Ocamlformat_lib_devversion"
   ; disable release renaming
   )))

(rule
 (action
  (write-file
   bin_conf.ml
   ; enable release renaming
   "include Bin_conf_devversion"
   ; disable release renaming
   )))

(executable
 (name main)
 (public_name
  ; enable release renaming
  ocamlformat-devversion
  ; disable release renaming
  )
 (package
  ; enable release renaming
  ocamlformat-devversion
  ; disable release renaming
  )
 (flags
  (:standard
   ; enable release renaming
   -open
   Ocamlformat_stdlib_devversion
   ; disable release renaming
   ))
 (instrumentation
  (backend bisect_ppx))
 (libraries
  ; enable release renaming
  ocamlformat-lib-devversion
  bin_conf_devversion
  ; disable release renaming
  ))

(rule
 (with-stdout-to
  ocamlformat.1
  (run ./main.exe --help=groff)))

(install
 (section man)
 (files ocamlformat.1)
 (package ocamlformat))
